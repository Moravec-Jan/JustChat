<div id=message-box>
  <mat-tab-group [(selectedIndex)]="selection">
    <mat-tab *ngFor="let conversation of conversations; let conversationIndex = index"
             [id]="conversation.user.id">
      <ng-template mat-tab-label>
        <mat-icon class="notification-icon" *ngIf="conversation.notifications > 0">notifications</mat-icon>
        {{conversation.user.name}}
        <mat-icon (click)="closeConversation(conversationIndex)">close</mat-icon>
      </ng-template>
      <div class="chat-container">
        <p class="message" *ngFor="let message of conversation.messages" [ngSwitch]="message.status">
          <mat-icon class="message-state" *ngSwitchCase="'unknown'">sync</mat-icon>
          <mat-icon class="message-state" *ngSwitchCase="'success'">done</mat-icon>
          <mat-icon class="message-state" *ngSwitchCase="'failure'">error</mat-icon>
          <b>{{message.author + ':'}}</b>
          {{message.body}}
        </p>
      </div>

    </mat-tab>
  </mat-tab-group>
  <form *ngIf="canSend" class="message-form full-width">
    <mat-form-field id="message-input">
      <textarea (keydown)="onKeydown($event)" class="message-textarea" autofocus rows="3" matInput
                [(ngModel)]="messageInput"
                placeholder="Your message" name="message"></textarea>
    </mat-form-field>
    <button mat-raised-button color="primary" id="send-button" (click)="onSubmit()" >
      Send
    </button>
  </form>


</div>
